<?php declare(strict_types=1);

// phpcs:disable Generic.Files.LineLength

/** @var \Magento\Framework\Escaper $escaper */
/** @var \Magento\Framework\View\Element\Template $block */
/** @var \Snowdog\Hyva\Checkout\Inpost\Magewire\Locker $magewire */

?>
<div>
    <script>
        (function () {
            window.addEventListener('checkout:shipping:method-activate', async () => {
                hyvaCheckout.shipping.activate('inpostlocker_standard', {
                    initialize: function () {
                        if (Magewire.find('checkout.shipping.method.inpostlocker_standard').get('locker')) {
                            alert(Magewire.find('checkout.shipping.method.inpostlocker_standard').get('locker'));
                        } else {
                            document.getElementById('inpost_geowidget').hidden = false;
                        }
                        document.addEventListener('onpointselect', function (event) {
                            Magewire.find('checkout.shipping.method.inpostlocker_standard').set('locker', event.detail.name)
                            document.getElementById('inpost_geowidget').hidden = true;
                            document.getElementById('inpost_locker').innerText = event.detail.name;
                        });
                    }
                });
            }, {once: true})
        })();

        function changeLocker() {
            document.getElementById('inpost_geowidget').hidden = false;
        }
    </script>

    <div id="inpost_locker"><?= $magewire->locker ?></div>

    <button onclick="changeLocker()">Change Locker</button>

    <link rel="stylesheet" href="<?= $magewire->getGeoCssUrl() ?>"/>
    <script src='<?= $magewire->getGeoJsUrl() ?>' defer></script>

    <inpost-geowidget id="inpost_geowidget" hidden="true" onpoint="onpointselect" token='<?= $magewire->getGeoToken() ?>' language='pl'
                      config='parcelcollect'></inpost-geowidget>
</div>
